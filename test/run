#! /bin/bash
# This is the expected entry point for Cockpit CI; will be called without
# arguments but with an appropriate $TEST_OS

set -eux

TEST_SCENARIO="${TEST_SCENARIO:-}"
[ "${TEST_SCENARIO}" = "${TEST_SCENARIO##firefox}" ] || export TEST_BROWSER=firefox
export RUN_TESTS_OPTIONS=--track-naughties

# linters are off by default for production builds, but we want to run them in CI
export LINT=1

make bots
sed 's/0.4.0/0.5.2/g' bots/images/scripts/cirros.bootstrap > cirros.bootstrap
sh -ex cirros.bootstrap `pwd`/cirros.img
rm cirros.bootstrap

make codecheck
make check
make po/machines.pot
